---
title: "stm"
output: html_document
date: "2024-02-21"
---

```{r setup, include=FALSE}
library(quanteda)
library(stm)
library(textclean)
library(stringr)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
setwd("/Users/lijiazheng/Desktop")
df_pub <- read.csv("preprocessed_content_analysis.csv")
```


```{r}
# Preprocess and tokenize
english_words <- lexicon::hash_lemmas$WORD

df_pub$cleaned_abstract <- df_pub$normalized_abstract %>%
  str_replace_all("[^\\w\\s]", " ") %>%
  str_to_lower() %>%
  str_squish()

tokens <- tokens(df_pub$cleaned_abstract) %>%
  tokens_remove(stopwords("en"), padding = FALSE) %>%
  tokens_remove(pattern = "\\b[[:digit:]]+\\b", valuetype = "regex") %>%
  tokens_remove(pattern = c("[", "]", ",", "(", ")", ".", ";", ":", "\"", "/", "{", "}"), valuetype = "fixed") %>%
  tokens_remove(pattern = "\\b[a-z]{1,2}\\b", valuetype = "regex")

# Create DFM and remove non-English words
dfm <- dfm(tokens) %>%
  dfm_select(pattern = english_words, selection = "keep", valuetype = "fixed")
```

```{r}
dtm <- convert(dfm, to = "stm")
documents <- dtm$documents
vocab <- dtm$vocab
```

```{r}
meta <- data.frame(publication_year = df_pub$publication_year)
print(nrow(meta))
```


```{r}
empty_docs <- which(lengths(tokens) == 0)
print(empty_docs)
```



```{r}
meta <- meta[-c(70523, 70525), , drop = FALSE]
print(nrow(meta))  # Should now print the correct number of rows
print(is.data.frame(meta))  
```

```{r}
stmFit_10 <- stm(documents = documents, vocab = vocab, K = 10, prevalence = ~ publication_year, data = meta, max.em.its = 50)
labelTopics(stmFit_10, n = 10)
```


```{r}
topic_terms <- stm::labelTopics(model = stmFit_10, topics = 10, n = 50)
print(topic_terms)
```
```{r}
# Estimate the effect of publication year on topic prevalence
effect <- estimateEffect(1:10 ~ publication_year, stmFit_10, metadata = meta)

```


```{r}
options(repr.plot.width=16, repr.plot.height=8)

# Generate the plot without the default legend
plot(effect, "publication_year", method = "continuous", topics = c(1, 4, 5, 10), model = stmFit_10, 
     xlab = "Publication Year", ylab = "Topic Proportion", 
     main = "Topic Trends Over Time", 
     cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.2, lwd = 2)

```

```{r}
options(repr.plot.width=16, repr.plot.height=8)

# Generate the plot without the default legend
plot(effect, "publication_year", method = "continuous", topics = c(2, 3, 6:9), model = stmFit_10, 
     xlab = "Publication Year", ylab = "Topic Proportion", 
     main = "Topic Trends Over Time", 
     cex.main = 1.5, cex.lab = 1.5, cex.axis = 1.2, lwd = 2)

```




```{r}
topic 1 : Child and Adolescent Development
topic 2 : Socio-Political Dynamics and Cultural Studies
topic 3:  Climate Change and Environmental Dynamics
topic 4:  Cognitive and Neural Science
topic 5:  Evolutionary Biology and Genetics
topic 6:  Social Psychology and Emotional Dynamics
topic 7:  Linguistics and Language Acquisition
topic 8:  Archaeology and Ancient Human Civilizations
topic 9: Multilingual Studies in Social Sciences
topic 10: Research design and methodology
  
```



Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
